<h1>Available Time Slots</h1>

<% if flash[:notice] %>
  <p style="color: green;"><%= flash[:notice] %></p>
<% end %>
<% if flash[:alert] %>
  <p style="color: red;"><%= flash[:alert] %></p>
<% end %>

<!-- Date Picker Section -->
<div style="margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 8px;">
  <h3 style="margin-top: 0;">Select a Date</h3>
  <%= form_with url: tables_path, method: :get, local: true do %>
    <div style="display: flex; align-items: center; gap: 10px;">
      <input type="date" 
             name="date" 
             value="<%= @selected_date.to_s %>" 
             min="<%= @today_date.to_s %>"
             style="padding: 8px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px;">
      <input type="submit" 
             value="Check Availability" 
             style="padding: 8px 16px; font-size: 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
      <%= link_to "My Reservations", my_reservations_path, style: "padding: 8px 16px; font-size: 16px; background-color: #2196F3; color: white; text-decoration: none; border-radius: 4px; border: 1px solid #1976D2;" %>
    </div>
  <% end %>
  <p style="margin-top: 10px; color: #666; font-size: 14px;">
    Showing time slots for: <strong><%= @selected_date.strftime("%B %d, %Y") %></strong>
    <span style="color: #999;">(Asia/Manila timezone)</span>
  </p>
</div>

<!-- Time Slots Table -->
<% if @tables.any? %>
  <table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%; max-width: 600px;">
    <thead style="background-color: #333; color: white;">
      <tr>
        <th style="padding: 12px;">Time</th>
        <th style="padding: 12px;">Available Seats</th>
        <th style="padding: 12px;">Action</th>
      </tr>
    </thead>
    <tbody>
      <% @tables.each do |table| %>
        <% is_full = table.remaining_seats == 0 %>
        <tr style="<%= is_full ? 'background-color: #FFCCCC;' : 'background-color: #FFFFFF;' %>">
          <td style="padding: 12px; text-align: center; font-weight: bold;">
            <%= table.start_time.in_time_zone("Asia/Manila").strftime("%I:%M %p") %>
          </td>
          <td style="padding: 12px; text-align: center;">
            <span style="<%= is_full ? 'color: #CC0000;' : 'color: #006600;' %> font-weight: bold;">
              <%= table.remaining_seats %>
            </span>
          </td>
          <td style="padding: 12px; text-align: center;">
            <% if table.remaining_seats > 0 %>
              <%= link_to "Book Now", new_reservation_path(table_id: table.id), class: "book-btn", style: "padding: 6px 12px; background-color: #2196F3; color: white; text-decoration: none; border-radius: 4px; display: inline-block;" %>
            <% else %>
              <span style="color: #999;">Full</span>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div style="padding: 20px; background-color: #FFF3CD; border: 1px solid #FFEEBA; border-radius: 4px; max-width: 600px;">
    <p style="margin: 0; color: #856404;">No time slots available for <strong><%= @selected_date.strftime("%B %d, %Y") %></strong>. Please select another date.</p>
  </div>
<% end %>
