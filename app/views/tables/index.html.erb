<h1>Available Time Slots</h1>

<% if flash[:notice] %>
  <p style="color: green;"><%= flash[:notice] %></p>
<% end %>
<% if flash[:alert] %>
  <p style="color: red;"><%= flash[:alert] %></p>
<% end %>

<!-- Date Picker Section -->
<div style="margin-bottom: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 8px;">
  <h3 style="margin-top: 0;">Select a Date</h3>
  <%= form_with url: tables_path, method: :get, local: true do %>
    <div style="display: flex; align-items: center; gap: 10px;">
      <input type="date" 
             name="date" 
             value="<%= @selected_date.to_s %>" 
             min="<%= @today_date.to_s %>"
             style="padding: 8px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px;">
      <input type="submit" 
             value="Check Availability" 
             style="padding: 8px 16px; font-size: 16px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
    </div>
  <% end %>
  <p style="margin-top: 10px; color: #666; font-size: 14px;">
    Showing time slots for: <strong><%= @selected_date.strftime("%B %d, %Y") %></strong>
    <span style="color: #999;">(Asia/Manila timezone)</span>
  </p>
</div>

<!-- Time Slots Table -->
<% if @tables.any? %>
  <table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%; max-width: 600px;">
    <thead style="background-color: #333; color: white;">
      <tr>
        <th style="padding: 12px;">Time</th>
        <th style="padding: 12px;">Availability</th>
        <th style="padding: 12px;">Action</th>
      </tr>
    </thead>
    <tbody>
      <% @tables.each do |table| %>
        <% is_full = table.remaining_seats == 0 %>
        <tr style="<%= is_full ? 'background-color: #FFCCCC;' : 'background-color: #FFFFFF;' %>">
          <td style="padding: 12px; text-align: center; font-weight: bold;">
            <%= table.start_time.in_time_zone("Asia/Manila").strftime("%I:%M %p") %>
          </td>
          <td style="padding: 12px; text-align: center;">
            <% if is_full %>
              <span style="color: #CC0000; font-weight: bold;">Full</span>
            <% else %>
              <span style="color: #006600;"><%= table.remaining_seats %> of <%= table.capacity %> seats available</span>
            <% end %>
          </td>
          <td style="padding: 12px; text-align: center;">
            <% if table.remaining_seats > 0 %>
              <%= form_with url: reservations_path, method: :post, local: true do %>
                <input type="hidden" name="table_id" value="<%= table.id %>">
                <div style="display: flex; align-items: center; justify-content: center; gap: 5px;">
                  <input type="number" name="guest_count" value="1" min="1" max="<%= table.remaining_seats %>" style="width: 50px; padding: 4px;">
                  <input type="submit" value="Book" style="padding: 4px 12px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">
                </div>
              <% end %>
            <% else %>
              <span style="color: #999;">â€”</span>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div style="padding: 20px; background-color: #FFF3CD; border: 1px solid #FFEEBA; border-radius: 4px; max-width: 600px;">
    <p style="margin: 0; color: #856404;">No time slots available for <strong><%= @selected_date.strftime("%B %d, %Y") %></strong>. Please select another date.</p>
  </div>
<% end %>

<p style="margin-top: 20px;"><a href="<%= my_reservations_path %>">My Reservations</a></p>
