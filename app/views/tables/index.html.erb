<h1>Available Time Slots</h1>

<!-- Date Picker Section -->
<div style="margin-bottom: 20px; padding: 15px; background-color: #C0C0C0; border: 2px solid black; font-family: 'Times New Roman', serif;">
  <h3 style="margin-top: 0; color: black; border-bottom: 2px solid gray; padding-bottom: 5px;">Select a Date</h3>
  
  <form action="/tables" accept-charset="UTF-8" method="get">
    <div style="display: flex; align-items: center; gap: 10px;">
      <input type="date" name="date" value="<%= @selected_date %>" min="<%= @today_date %>" 
             style="padding: 6px; font-size: 16px; border: 2px inset #ffffff; border-radius: 0; background: white; font-family: 'Times New Roman', serif;">
      
      <input type="submit" value="Check Availability" class="btn btn-success">
      <a class="btn btn-primary" href="/my_reservations">My Reservations</a>
    </div>
  </form>

  <p style="margin-top: 10px; color: black; font-size: 16px;">
    Showing time slots for: <strong><%= @selected_date.strftime("%B %d, %Y") %></strong>
    <span style="color: #333;">(Asia/Manila timezone)</span>
  </p>
</div>

<% if @tables.any? %>
  <%
    # Group tables by meal period
    breakfast = @tables.select { |t| [7, 8, 9, 10].include?(t.start_time.in_time_zone("Asia/Manila").hour) }
    lunch = @tables.select { |t| [11, 12, 13, 14].include?(t.start_time.in_time_zone("Asia/Manila").hour) }
    dinner = @tables.select { |t| [18, 19, 20, 21].include?(t.start_time.in_time_zone("Asia/Manila").hour) }
  %>

  <% if breakfast.any? %>
    <h2 style="margin-top: 20px; border-bottom: 2px solid #000080;">Breakfast (07:00 - 10:00)</h2>
    <%= render partial: "time_slots_table", locals: { tables: breakfast } %>
  <% end %>

  <% if lunch.any? %>
    <h2 style="margin-top: 20px; border-bottom: 2px solid #000080;">Lunch (11:00 - 14:00)</h2>
    <%= render partial: "time_slots_table", locals: { tables: lunch } %>
  <% end %>

  <% if dinner.any? %>
    <h2 style="margin-top: 20px; border-bottom: 2px solid #000080;">Dinner (18:00 - 21:00)</h2>
    <%= render partial: "time_slots_table", locals: { tables: dinner } %>
  <% end %>

<% else %>
  <div style="padding: 20px; background-color: #FFF3CD; border: 2px solid #000000; max-width: 600px;">
    <p style="margin: 0; color: black;">No time slots available for <strong><%= @selected_date.strftime("%B %d, %Y") %></strong>. Please select another date.</p>
  </div>
<% end %>
