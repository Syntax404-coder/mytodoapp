<h1>Available Time Slots</h1>

<!-- Date Picker -->
<div style="margin-bottom: 20px; padding: 15px; background-color: #C0C0C0; border: 2px solid black;">
  <h3 style="margin-top: 0; border-bottom: 2px solid gray; padding-bottom: 5px;">Select a Date</h3>
  
  <form action="/tables" method="get">
    <div style="display: flex; align-items: center; gap: 10px;">
      <input type="date" name="date" value="<%= @selected_date %>" min="<%= @today_date %>" 
             style="padding: 6px; font-size: 16px; border: 2px inset #ffffff;">
      <input type="submit" value="Check Availability" class="btn btn-success">
      <a class="btn btn-primary" href="/my_reservations">My Reservations</a>
    </div>
  </form>

  <p style="margin-top: 10px;">
    Showing: <strong><%= @selected_date.strftime("%B %d, %Y") %></strong>
  </p>
</div>

<p><strong>Debug: Found <%= @tables.count %> slots</strong></p>

<% if @tables.any? %>
  <%
    # Group by hour (using local time)
    breakfast = @tables.select { |t| (7..10).include?(t.start_time.hour) }
    lunch = @tables.select { |t| (11..14).include?(t.start_time.hour) }
    dinner = @tables.select { |t| (18..21).include?(t.start_time.hour) }
  %>

  <% if breakfast.any? %>
    <h2 style="border-bottom: 2px solid #000080;">Breakfast (07:00 - 10:00) - <%= breakfast.count %> slots</h2>
    <table style="width: 100%; max-width: 600px; margin-bottom: 20px;">
      <thead><tr><th>Time</th><th>Available Seats</th><th>Action</th></tr></thead>
      <tbody>
        <% breakfast.each do |table| %>
          <tr style="background-color: <%= table.remaining_seats == 0 ? '#FFCCCC' : '#FFFFFF' %>;">
            <td style="padding: 12px; text-align: center; font-weight: bold;"><%= table.start_time.strftime("%H:%M") %></td>
            <td style="padding: 12px; text-align: center; color: <%= table.remaining_seats == 0 ? '#CC0000' : '#006600' %>;"><%= table.remaining_seats %></td>
            <td style="padding: 12px; text-align: center;">
              <% if table.remaining_seats > 0 %>
                <%= link_to "Book Now", new_reservation_path(table_id: table.id), class: "btn btn-primary" %>
              <% else %>
                <span style="color: #999;">Full</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

  <% if lunch.any? %>
    <h2 style="border-bottom: 2px solid #000080;">Lunch (11:00 - 14:00) - <%= lunch.count %> slots</h2>
    <table style="width: 100%; max-width: 600px; margin-bottom: 20px;">
      <thead><tr><th>Time</th><th>Available Seats</th><th>Action</th></tr></thead>
      <tbody>
        <% lunch.each do |table| %>
          <tr style="background-color: <%= table.remaining_seats == 0 ? '#FFCCCC' : '#FFFFFF' %>;">
            <td style="padding: 12px; text-align: center; font-weight: bold;"><%= table.start_time.strftime("%H:%M") %></td>
            <td style="padding: 12px; text-align: center; color: <%= table.remaining_seats == 0 ? '#CC0000' : '#006600' %>;"><%= table.remaining_seats %></td>
            <td style="padding: 12px; text-align: center;">
              <% if table.remaining_seats > 0 %>
                <%= link_to "Book Now", new_reservation_path(table_id: table.id), class: "btn btn-primary" %>
              <% else %>
                <span style="color: #999;">Full</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

  <% if dinner.any? %>
    <h2 style="border-bottom: 2px solid #000080;">Dinner (18:00 - 21:00) - <%= dinner.count %> slots</h2>
    <table style="width: 100%; max-width: 600px; margin-bottom: 20px;">
      <thead><tr><th>Time</th><th>Available Seats</th><th>Action</th></tr></thead>
      <tbody>
        <% dinner.each do |table| %>
          <tr style="background-color: <%= table.remaining_seats == 0 ? '#FFCCCC' : '#FFFFFF' %>;">
            <td style="padding: 12px; text-align: center; font-weight: bold;"><%= table.start_time.strftime("%H:%M") %></td>
            <td style="padding: 12px; text-align: center; color: <%= table.remaining_seats == 0 ? '#CC0000' : '#006600' %>;"><%= table.remaining_seats %></td>
            <td style="padding: 12px; text-align: center;">
              <% if table.remaining_seats > 0 %>
                <%= link_to "Book Now", new_reservation_path(table_id: table.id), class: "btn btn-primary" %>
              <% else %>
                <span style="color: #999;">Full</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

<% else %>
  <div style="padding: 20px; background-color: #FFF3CD; border: 2px solid black;">
    <p style="margin: 0;">No time slots available for <strong><%= @selected_date.strftime("%B %d, %Y") %></strong>.</p>
  </div>
<% end %>
